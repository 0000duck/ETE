////////////////////////////////////////////////////////////////////////////////
// Module for virtual operating system functions for FireBus.
// intek, C. Kuehnel, 5.12.2002
////////////////////////////////////////////////////////////////////////////////

#include <osutil.h>

////////////////////////////////////////////////////////////////////////////////
// Delay thread in ms.
////////////////////////////////////////////////////////////////////////////////

void OSDelay(UINT32 TimeInMs)
{
  Sleep(TimeInMs);
}

////////////////////////////////////////////////////////////////////////////////
// Create a semaphore in memory.
////////////////////////////////////////////////////////////////////////////////

POSSEMAPHORE OSSemaphoreCreate(UINT32 State)
{
  HANDLE Semaphore;
  
  Semaphore=CreateSemaphore(NULL,State,0x7FFFFFFF,NULL);

  return (POSSEMAPHORE)Semaphore;
}

////////////////////////////////////////////////////////////////////////////////
// Free sempahore in memory.
////////////////////////////////////////////////////////////////////////////////

void OSSemaphoreDelete(POSSEMAPHORE pSemaphore)
{
  CloseHandle((HANDLE)pSemaphore);
}

////////////////////////////////////////////////////////////////////////////////
// Release a semphore.
////////////////////////////////////////////////////////////////////////////////

void OSSemaphorePost(POSSEMAPHORE pSemaphore)
{
  ReleaseSemaphore(pSemaphore,1,NULL);
}

////////////////////////////////////////////////////////////////////////////////
// Pend for a semaphore.
////////////////////////////////////////////////////////////////////////////////

UINT8 OSSemaphorePend(POSSEMAPHORE pSemaphore,UINT32 TimeoutInMs)
{
  DWORD Result;

  Result=WaitForSingleObject(pSemaphore,(TimeoutInMs==OSINFTIME)?INFINITE:TimeoutInMs);
  if(Result!=WAIT_OBJECT_0)
   return FALSE;

   return TRUE;
}

